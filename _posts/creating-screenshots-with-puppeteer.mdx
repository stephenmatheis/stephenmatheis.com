---
status: draft
title: Creating screenshots with Puppeteer
date: 'Thursday, September 21, 2023 6:39:01 PM CDT'
lastModified: 'Thursday, September 21, 2023 6:39:01 PM CDT'
author: Stephen Matheis
---

I use [Instapaper](https://www.instapaper.com) to save bookmarks. I rarely go back to look at them. I mainly just want to feel safe closing tabs.

Recently, I did want to revisit a site. But I could only remember what it looked like. Instapaper only shows a site's title, description, address, and favicon. What I wanted was a way to flip through sites like a photo album.

I really didn't feel like loading each site one at a time, though. So I exported every site I had saved to a CSV file. Then I used [csvjson](https://csvkit.readthedocs.io/en/1.1.1/scripts/csvjson.html) to convert it to JSON and save the output to a new file which I manually edited in [VS Code](https://code.visualstudio.com/) to export a JS object so it could be [imported later in a Node.js script](#post-{id}-ln-6).

[TBD]

This script, actually.

```js title="screenshot.js" showLineNumbers {6}
import puppeteer from 'puppeteer';
import { createWriteStream } from 'fs';
import { stat } from 'fs/promises';
import log from '../utils/log.js';

// [1] See. Told ya we'd import it later.
import bookmarks from '../bookmarks.js';

const fileName = `./logs/log-${new Date().toISOString()}.txt`;
const stream = createWriteStream(fileName, { flags: 'a' });
const browser = await puppeteer.launch({ headless: 'new' });
const page = await browser.newPage();

for (let [index, bookmark] of bookmarks.entries()) {
    const doesExist = await fileExists(`./public/bookmarks/${index}.png`);

    if (doesExist) {
        continue;
    }

    try {
        await page.goto(bookmark.URL, { waitUntil: 'networkidle2' });
    } catch (error) {
        console.error(error);

        continue;
    }

    await page.setViewport({ width: 1920, height: 1080 });

    await page.screenshot({ path: `./public/bookmarks/${index}.png` });
}

await browser.close();

stream.end();

async function fileExists(path) {
    return !!(await stat(path).catch((e) => false));
}
```
